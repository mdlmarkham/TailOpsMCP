# TailOpsMCP Multi-Container Installation Configuration
# This configuration file is used for deploying TailOpsMCP to multiple LXC containers from a Proxmox host

# ==============================================================================
# CONTAINER SELECTION
# ==============================================================================

# Option 1: Specify existing container IDs (comma-separated)
# CONTAINERS="101,102,103"

# Option 2: Specify existing container names (comma-separated)
# CONTAINER_NAMES="tailops-dev,tailops-staging,tailops-prod"

# Option 3: Create new containers (requires template configuration below)
# CONTAINERS="201,202,203"
# CREATE_CONTAINERS=true

# ==============================================================================
# CONTAINER CREATION SETTINGS (if CREATE_CONTAINERS=true)
# ==============================================================================

# LXC template to use for new containers
# Download templates with: pveam update && pveam available
# Common options: debian-12-standard, ubuntu-22.04-standard, rocky-9-default
CONTAINER_TEMPLATE="debian-12-standard"

# Storage location for templates and container disks
CONTAINER_STORAGE="local-lvm"

# Default container resources
CONTAINER_DISK_SIZE="8G"     # Disk size (minimum 5G recommended)
CONTAINER_MEMORY=2048         # Memory in MB (minimum 1024 recommended)
CONTAINER_CORES=2             # CPU cores

# Network configuration
CONTAINER_NETWORK_BRIDGE="vmbr0"
CONTAINER_IP_MODE="dhcp"      # dhcp or static

# Container naming pattern (${HOSTNAME_PREFIX}-${CTID})
HOSTNAME_PREFIX="tailops"

# ==============================================================================
# INSTALLATION SETTINGS
# ==============================================================================

# Installation mode:
#   - standalone: Each container runs independently
#   - coordinated: Future: load balancing / shared state (not yet implemented)
INSTALL_MODE="standalone"

# Installation directory on each container
SYSTEMMANAGER_INSTALL_DIR="/opt/systemmanager"

# Git repository and branch
SYSTEMMANAGER_REPO="https://github.com/mdlmarkham/TailOpsMCP.git"
SYSTEMMANAGER_REPO_BRANCH="main"

# Skip Docker installation (set to true if containers won't use Docker features)
SKIP_DOCKER=false

# ==============================================================================
# AUTHENTICATION CONFIGURATION
# ==============================================================================

# Authentication mode: oidc, token, or none
#
# - oidc: Tailscale OAuth (recommended for production)
# - token: Shared secret authentication
# - none: No authentication (development only, NOT for production)
AUTH_MODE="oidc"

# For AUTH_MODE=token: Shared secret for all containers
# Leave empty to auto-generate
SYSTEMMANAGER_SHARED_SECRET=""

# For AUTH_MODE=oidc: Tailscale Identity Provider settings
# Set up TSIDP at: https://login.tailscale.com/admin/settings/oauth
TSIDP_URL=""
TSIDP_CLIENT_ID=""
TSIDP_CLIENT_SECRET=""

# ==============================================================================
# PER-CONTAINER OVERRIDES
# ==============================================================================

# Override settings for specific containers using format:
# CONTAINER_CONFIG_<CTID>_<SETTING>=value
#
# Example: Different ports for each container
# CONTAINER_CONFIG_101_PORT=8080
# CONTAINER_CONFIG_102_PORT=8081
# CONTAINER_CONFIG_103_PORT=8082
#
# Example: Different authentication for specific container
# CONTAINER_CONFIG_103_AUTH_MODE=none
#
# Example: Container-specific shared secrets
# CONTAINER_CONFIG_101_SHARED_SECRET="secret-for-101"
# CONTAINER_CONFIG_102_SHARED_SECRET="secret-for-102"

# ==============================================================================
# DEPLOYMENT OPTIONS
# ==============================================================================

# Deployment strategy:
#   - sequential: Install containers one at a time (safer, easier to debug)
#   - parallel: Install all containers simultaneously (faster)
DEPLOYMENT_STRATEGY="sequential"

# Maximum parallel deployments (only used if DEPLOYMENT_STRATEGY=parallel)
MAX_PARALLEL=3

# Auto-fix container features (nesting, TUN device, etc.)
AUTO_FIX_FEATURES=true

# Continue on failure: if one container fails, continue with others
CONTINUE_ON_FAILURE=true

# Validate installation after deployment
RUN_VALIDATION=true

# ==============================================================================
# ADVANCED OPTIONS
# ==============================================================================

# Force reinstall even if TailOpsMCP is already installed
FORCE_REINSTALL=false

# Backup existing installation before upgrade
BACKUP_BEFORE_INSTALL=true

# Logging
LOG_LEVEL="info"  # debug, info, warning, error
LOG_DIR="/var/log/systemmanager-install"

# Timeouts (in seconds)
CONTAINER_START_TIMEOUT=30
INSTALL_TIMEOUT=600

# Non-interactive mode (no prompts)
NON_INTERACTIVE=false

# ==============================================================================
# EXAMPLE CONFIGURATIONS
# ==============================================================================

# Example 1: Install on 3 existing containers with OIDC auth
# CONTAINERS="101,102,103"
# AUTH_MODE="oidc"
# TSIDP_URL="https://tsidp.tail12345.ts.net"
# TSIDP_CLIENT_ID="your-client-id"
# TSIDP_CLIENT_SECRET="your-client-secret"

# Example 2: Create 3 new containers with token auth
# CONTAINERS="201,202,203"
# CREATE_CONTAINERS=true
# AUTH_MODE="token"
# SYSTEMMANAGER_SHARED_SECRET="your-secret-here"

# Example 3: Development setup - 2 containers, no auth
# CONTAINERS="301,302"
# CREATE_CONTAINERS=true
# AUTH_MODE="none"
# SKIP_DOCKER=true
