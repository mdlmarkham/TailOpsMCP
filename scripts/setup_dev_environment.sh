#!/bin/bash\n# TailOpsMCP Development Environment Setup Script\n# Sets up the complete development environment for TailOpsMCP project\n\nset -e  # Exit on any error\n\n# Colors for output\nRED='\033[0;31m'\nGREEN='\033[0;32m'\nYELLOW='\033[1;33m'\nBLUE='\033[0;34m'\nPURPLE='\033[0;35m'\nCYAN='\033[0;36m'\nNC='\033[0m' # No Color\n\n# Configuration\nPYTHON_MIN_VERSION="3.12"\nPROJECT_NAME="TailOpsMCP"\nREQUIREMENTS_FILE="requirements-dev.txt"\nSETUP_COMPLETE_FLAG=".dev_setup_complete"\n\n# Helper functions\nprint_header() {\n    echo -e "\n${BLUE}=== $1 ===${NC}"\n}\n\nprint_success() {\n    echo -e "${GREEN}‚úÖ $1${NC}"\n}\n\nprint_warning() {\n    echo -e "${YELLOW}‚ö†Ô∏è  $1${NC}"\n}\n\nprint_error() {\n    echo -e "${RED}‚ùå $1${NC}"\n}\n\nprint_info() {\n    echo -e "${CYAN}‚ÑπÔ∏è  $1${NC}"\n}\n\n# Check if command exists\ncommand_exists() {\n    command -v "$1" >/dev/null 2>&1\n}\n\n# Check Python version\ncheck_python_version() {\n    print_info "Checking Python version..."\n\n    if ! command_exists python3; then\n        print_error "Python 3 is not installed or not in PATH"\n        print_info "Please install Python 3.12 or later from https://python.org"\n        exit 1\n    fi\n\n    python_version=$(python3 -c "import sys; print('.'.join(map(str, sys.version_info[:2])))")\n    required_version=$(echo "$PYTHON_MIN_VERSION" | tr '.' ' ')\n\n    if python3 -c "import sys; exit(0 if sys.version_info >= ($required_version) else 1)"; then\n        print_success "Python $python_version found (minimum: $PYTHON_MIN_VERSION)"\n    else\n        print_error "Python version $python_version is too old. Minimum required: $PYTHON_MIN_VERSION"\n        exit 1\n    fi\n}\n\n# Check pip\ncheck_pip() {\n    print_info "Checking pip..."\n\n    if ! command_exists pip3 && ! python3 -m pip --version >/dev/null 2>&1; then\n        print_error "pip is not installed or not accessible"\n        print_info "Installing pip..."\n        python3 -m ensurepip --upgrade\n    fi\n\n    print_success "pip is available"\n}\n\n# Check virtual environment tools\ncheck_virtual_env_tools() {\n    print_info "Checking virtual environment tools..."\n\n    if ! command_exists virtualenv && ! python3 -m venv --help >/dev/null 2>&1; then\n        print_warning "No virtual environment tool found. Installing python3-venv..."\n        if command_exists apt-get; then\n            sudo apt-get update && sudo apt-get install -y python3-venv\n        elif command_exists yum; then\n            sudo yum install -y python3-venv\n        elif command_exists brew; then\n            brew install python3\n        else\n            print_warning "Could not install python3-venv automatically"\n        fi\n    else\n        print_success "Virtual environment tools available"\n    fi\n}\n\n# Create virtual environment\nsetup_virtual_environment() {\n    print_info "Setting up virtual environment..."\n\n    if [ ! -d "venv" ]; then\n        python3 -m venv venv\n        print_success "Virtual environment created"\n    else\n        print_info "Virtual environment already exists"\n    fi\n\n    # Activate virtual environment\n    source venv/bin/activate\n    print_success "Virtual environment activated"\n\n    # Upgrade pip\n    pip install --upgrade pip\n    print_success "pip upgraded to latest version"\n}\n\n# Install project dependencies\ninstall_dependencies() {\n    print_info "Installing project dependencies..."\n\n    if [ -f "$REQUIREMENTS_FILE" ]; then\n        pip install -r "$REQUIREMENTS_FILE"\n        print_success "Development dependencies installed"\n    else\n        print_warning "$REQUIREMENTS_FILE not found, installing basic dependencies"\n        pip install pytest ruff mypy bandit safety pre-commit\n    fi\n\n    # Install project in development mode\n    if [ -f "pyproject.toml" ] || [ -f "setup.py" ]; then\n        pip install -e .\n        print_success "Project installed in development mode"\n    else\n        print_warning "No pyproject.toml or setup.py found"\n    fi\n}\n\n# Set up pre-commit hooks\nsetup_pre_commit() {\n    print_info "Setting up pre-commit hooks..."\n\n    if command_exists pre-commit; then\n        # Install pre-commit hooks\n        pre-commit install\n        print_success "Pre-commit hooks installed"\n\n        # Run pre-commit on all files to set up the environment\n        print_info "Running initial pre-commit check..."\n        if pre-commit run --all-files; then\n            print_success "Pre-commit setup completed successfully"\n        else\n            print_warning "Some pre-commit checks failed. This is normal for the first run."\n            print_info "Run 'pre-commit run --all-files' later to fix issues"\n        fi\n    else\n        print_warning "pre-commit not found, skipping hook installation"\n    fi\n}\n\n# Install additional development tools\ninstall_dev_tools() {\n    print_info "Installing additional development tools..."\n\n    # Install radon for complexity analysis\n    pip install radon\n    print_success "Radon installed for complexity analysis"\n\n    # Install additional quality tools if needed\n    if command_exists git; then\n        print_info "Git detected - repository ready for development"\n    else\n        print_warning "Git not found - please install git for version control"\n    fi\n}\n\n# Create development configuration\nsetup_dev_config() {\n    print_info "Setting up development configuration..."\n\n    # Create .dev_config file\n    cat > .dev_config << EOF\n# TailOpsMCP Development Configuration\n# Generated on $(date)\n\n# Virtual environment\nVENV_PATH=venv\nPYTHON_PATH=python3\n\n# Development tools\nLINTER=ruff\nFORMATTER=ruff\nTYPE_CHECKER=mypy\nTEST_RUNNER=pytest\nSECURITY_SCANNER=bandit\n\n# Pre-commit hooks\nPRE_COMMIT_ENABLED=true\n\n# Project info\nPROJECT_NAME=$PROJECT_NAME\nSETUP_DATE=$(date)\nEOF\n\n    print_success "Development configuration created (.dev_config)"\n}\n\n# Verify installation\nverify_installation() {\n    print_info "Verifying installation..."\n\n    # Test Python imports\n    if python3 -c "import pytest, ruff, mypy, bandit" 2>/dev/null; then\n        print_success "All development tools can be imported"\n    else\n        print_warning "Some development tools may not be properly installed"\n    fi\n\n    # Test project installation\n    if python3 -c "import src" 2>/dev/null; then\n        print_success "Project can be imported"\n    else\n        print_warning "Project may not be properly installed"\n    fi\n\n    # Test security scanner\n    if python3 -c "from src.security.scanner import SecurityScanner" 2>/dev/null; then\n        print_success "Security scanner is working"\n    else\n        print_warning "Security scanner may have import issues"\n    fi\n}\n\n# Create development scripts\ncreate_dev_scripts() {\n    print_info "Creating development helper scripts..."\n\n    # Create activate script for easy venv activation\n    cat > activate_dev.sh << 'EOF'\n#!/bin/bash\n# Activate TailOpsMCP development environment\n\nif [ -f "venv/bin/activate" ]; then\n    source venv/bin/activate\n    echo "TailOpsMCP development environment activated"\n    echo "Python: $(which python)"\n    echo "Project: $(pwd)"\nelse\n    echo "Virtual environment not found. Run setup_dev_environment.sh first."\n    exit 1\nfi\nEOF\n\n    chmod +x activate_dev.sh\n    print_success "Development activation script created (activate_dev.sh)"\n\n    # Create quick test script\n    cat > quick_test.sh << 'EOF'\n#!/bin/bash\n# Quick test of the development environment\n\necho "üß™ Running quick development environment test..."\n\n# Test imports\necho "Testing Python imports..."\npython3 -c "import pytest, ruff, mypy, bandit; print('‚úÖ All tools imported successfully')"\n\n# Test project\necho "Testing project..."\npython3 -c "import src; print('‚úÖ Project imported successfully')"\n\n# Run a simple test\necho "Running a sample test..."\nif [ -d "tests" ]; then\n    python3 -m pytest tests/ -k "not test_" --collect-only >/dev/null 2>&1 && echo "‚úÖ Tests can be discovered" || echo "‚ö†Ô∏è  Test discovery had issues"\nelse\n    echo "‚ÑπÔ∏è  No tests directory found"\nfi\n\necho "‚úÖ Quick test completed"\nEOF\n\n    chmod +x quick_test.sh\n    print_success "Quick test script created (quick_test.sh)"\n}\n\n# Mark setup as complete\nmark_setup_complete() {\n    echo "SETUP_DATE=$(date)" > "$SETUP_COMPLETE_FLAG"\n    echo "PYTHON_VERSION=$(python3 -c "import sys; print('.'.join(map(str, sys.version_info[:3])))")" >> "$SETUP_COMPLETE_FLAG"\n    echo "SETUP_STATUS=SUCCESS" >> "$SETUP_COMPLETE_FLAG"\n    print_success "Setup marked as complete"\n}\n\n# Print summary\nprint_summary() {\n    print_header "Setup Summary"\n    echo -e "${GREEN}üéâ TailOpsMCP development environment setup completed!${NC}\n"\n\n    echo -e "${CYAN}üìÅ Created:${NC}"\n    echo "  ‚Ä¢ Virtual environment: ./venv/"\n    echo "  ‚Ä¢ Development config: ./.dev_config"\n    echo "  ‚Ä¢ Helper scripts: activate_dev.sh, quick_test.sh"\n\n    echo -e "\n${CYAN}üîß Available tools:${NC}"\n    echo "  ‚Ä¢ Python: $(python3 --version)"\n    echo "  ‚Ä¢ Testing: pytest"\n    echo "  ‚Ä¢ Linting: ruff"\n    echo "  ‚Ä¢ Formatting: ruff format"\n    echo "  ‚Ä¢ Type checking: mypy"\n    echo "  ‚Ä¢ Security: bandit, safety"\n    echo "  ‚Ä¢ Pre-commit hooks: pre-commit"\n    echo "  ‚Ä¢ Complexity: radon"\n\n    echo -e "\n${CYAN}üöÄ Next steps:${NC}"\n    echo "  1. Activate environment: source venv/bin/activate"\n    echo "  2. Or use helper: source activate_dev.sh"\n    echo "  3. Run tests: make test"\n    echo "  4. Run quality checks: make quality"\n    echo "  5. Run security scan: make security-scan"\n\n    echo -e "\n${CYAN}üìö Useful commands:${NC}"\n    echo "  ‚Ä¢ make help           - Show all available commands"\n    echo "  ‚Ä¢ make setup          - Set up development environment"\n    echo "  ‚Ä¢ make quality        - Run all quality checks"\n    echo "  ‚Ä¢ make test           - Run tests with coverage"\n    echo "  ‚Ä¢ make security-scan  - Run security scan"\n    echo "  ‚Ä¢ make fix            - Auto-fix code issues"\n\n    echo -e "\n${PURPLE}Happy coding! üöÄ${NC}\n"\n}\n\n# Main setup function\nmain() {\n    echo -e "${BLUE}"\n    cat << 'EOF'\n\n    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó\n    ‚ïë     TailOpsMCP Development Setup     ‚ïë\n    ‚ïë                                      ‚ïë\n    ‚ïë  Setting up your development environment...\n    ‚ïë\n    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù\nEOF\n    echo -e "${NC}"\n\n    # Check if setup was already completed\n    if [ -f "$SETUP_COMPLETE_FLAG" ]; then\n        print_info "Previous setup detected"\n        read -p "Do you want to re-run setup? (y/N): " -n 1 -r\n        echo\n        if [[ ! $REPLY =~ ^[Yy]$ ]]; then\n            print_info "Setup skipped. Run this script again to reconfigure."\n            exit 0\n        fi\n    fi\n\n    # Run setup steps\n    check_python_version\n    check_pip\n    check_virtual_env_tools\n    setup_virtual_environment\n    install_dependencies\n    setup_pre_commit\n    install_dev_tools\n    setup_dev_config\n    create_dev_scripts\n    verify_installation\n    mark_setup_complete\n    print_summary\n}\n\n# Handle script arguments\ncase "${1:-}" in\n    --help|-h)\n        echo "TailOpsMCP Development Environment Setup"\n        echo ""\n        echo "Usage: $0 [options]"\n        echo ""\n        echo "Options:"\n        echo "  --help, -h     Show this help message"\n        echo "  --force        Force re-setup even if already completed"\n        echo "  --skip-venv    Skip virtual environment creation"\n        echo ""\n        echo "This script sets up a complete development environment for TailOpsMCP"\n        echo "including virtual environment, dependencies, and development tools."\n        exit 0\n        ;;\n    --force)\n        rm -f "$SETUP_COMPLETE_FLAG"\n        print_info "Setup forced - will reconfigure everything"\n        ;;\n    --skip-venv)\n        SKIP_VENV=true\n        print_info "Skipping virtual environment creation"\n        ;;\nesac\n\n# Run main setup\nmain "$@"\n
