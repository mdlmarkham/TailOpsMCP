# Production Security-Focused Policy Configuration
# This policy enforces strict security controls for production environments

policies:
  version: "v2"
  name: "Production Security Policy"
  description: "Strict security policy for production environments with deny-by-default posture"
  deny_by_default: true
  enable_dry_run: true
  require_approval_for_admin: true
  audit_all_operations: true
  
  # Global rules (apply to all targets)
  global_policies:
    - name: "emergency_operations"
      description: "Emergency operations for critical issues"
      enabled: true
      operations:
        - service_restart
        - service_stop
        - backup_create
        - snapshot_create
      target_roles: [production]
      allowed: true
      requires_approval: false  # Emergency bypass
      time_restrictions:
        - start_time: "00:00"
          end_time: "23:59"
          days_of_week: [0,1,2,3,4,5,6]  # All days
          timezone: "UTC"
      parameter_constraints:
        service_name:
          type: "string"
          required: true
          max_length: 64
          pattern: "^[a-zA-Z0-9][a-zA-Z0-9_-]*$"
    
    - name: "system_observation"
      description: "Read-only system monitoring operations"
      enabled: true
      operations:
        - service_status
        - network_status
        - file_read
      target_roles: [production, development, staging]
      allowed: true
      requires_approval: false
      parameter_constraints:
        file_path:
          type: "string"
          required: true
          max_length: 1024
          pattern: "^[^<>:\"|?*]+$"
  
  # Role-based policies
  role_policies:
    production:
      - name: "production_service_management"
        description: "Production service management with strict controls"
        enabled: true
        operations:
          - service_restart
          - service_start
          - service_stop
        target_roles: [production]
        allowed: true
        requires_approval: true
        approval_timeout: 30
        time_restrictions:
          - start_time: "08:00"
            end_time: "18:00"
            days_of_week: [1,2,3,4,5]  # Monday-Friday
            timezone: "UTC"
        parameter_constraints:
          service_name:
            type: "string"
            required: true
            max_length: 64
            pattern: "^[a-zA-Z0-9][a-zA-Z0-9_-]*$"
          timeout:
            type: "int"
            required: false
            min: 30
            max: 300
            default: 60
      
      - name: "production_backup_operations"
        description: "Production backup operations with approval"
        enabled: true
        operations:
          - backup_create
          - backup_restore
          - backup_list
        target_roles: [production]
        allowed: true
        requires_approval: true
        approval_timeout: 60
        operation_timeout: 1800  # 30 minutes
        parameter_constraints:
          backup_id:
            type: "string"
            required: true
            max_length: 64
            pattern: "^[a-zA-Z0-9][a-zA-Z0-9_-]*$"
          target_path:
            type: "string"
            required: true
            max_length: 1024
            pattern: "^[^<>:\"|?*]+$"
      
      - name: "production_container_restrictions"
        description: "Strict container operations in production"
        enabled: true
        operations:
          - container_start
          - container_stop
          - container_restart
        target_roles: [production]
        allowed: true
        requires_approval: true
        approval_timeout: 15
        parameter_constraints:
          container_name:
            type: "string"
            required: true
            max_length: 64
            pattern: "^[a-zA-Z0-9][a-zA-Z0-9_-]*$"
            allowlist_source: "list_production_containers"
      
      - name: "production_dangerous_operations"
        description: "Dangerous operations that are denied in production"
        enabled: true
        operations:
          - container_delete
          - stack_remove
          - file_delete
          - package_remove
        target_roles: [production]
        allowed: false
        requires_approval: false
    
    development:
      - name: "development_full_access"
        description: "Full development environment access"
        enabled: true
        operations:
          - service_restart
          - service_start
          - service_stop
          - service_status
          - container_create
          - container_delete
          - container_start
          - container_stop
          - container_restart
          - container_inspect
          - stack_deploy
          - stack_remove
          - stack_update
          - file_read
          - file_write
          - file_delete
          - file_copy
          - backup_create
          - backup_restore
          - backup_list
          - backup_delete
          - package_update
          - package_install
          - package_remove
          - package_list
        target_roles: [development]
        allowed: true
        requires_approval: false
        operation_timeout: 600  # 10 minutes
        parameter_constraints:
          service_name:
            type: "string"
            required: true
            max_length: 64
            pattern: "^[a-zA-Z0-9][a-zA-Z0-9_-]*$"
          container_name:
            type: "string"
            required: true
            max_length: 64
            pattern: "^[a-zA-Z0-9][a-zA-Z0-9_-]*$"
          stack_name:
            type: "string"
            required: true
            max_length: 64
            pattern: "^[a-zA-Z0-9][a-zA-Z0-9_-]*$"
          file_path:
            type: "string"
            required: true
            max_length: 1024
            pattern: "^[^<>:\"|?*]+$"
          backup_id:
            type: "string"
            required: true
            max_length: 64
            pattern: "^[a-zA-Z0-9][a-zA-Z0-9_-]*$"
          package_name:
            type: "string"
            required: true
            max_length: 128
            pattern: "^[a-zA-Z0-9][a-zA-Z0-9._+-]*$"
    
    staging:
      - name: "staging_moderate_access"
        description: "Moderate access for staging environment"
        enabled: true
        operations:
          - service_restart
          - service_start
          - service_stop
          - service_status
          - container_start
          - container_stop
          - container_restart
          - container_inspect
          - stack_deploy
          - stack_update
          - file_read
          - file_write
          - backup_create
          - backup_list
        target_roles: [staging]
        allowed: true
        requires_approval: false
        parameter_constraints:
          service_name:
            type: "string"
            required: true
            max_length: 64
            pattern: "^[a-zA-Z0-9][a-zA-Z0-9_-]*$"
          container_name:
            type: "string"
            required: true
            max_length: 64
            pattern: "^[a-zA-Z0-9][a-zA-Z0-9_-]*$"
          stack_name:
            type: "string"
            required: true
            max_length: 64
            pattern: "^[a-zA-Z0-9][a-zA-Z0-9_-]*$"
  
  # Emergency policies (highest priority)
  emergency_policies:
    - name: "emergency_override"
      description: "Emergency override for critical situations"
      enabled: true
      operations:
        - service_restart
        - service_start
        - service_stop
        - container_start
        - container_stop
        - backup_create
      target_roles: [production, staging, development]
      allowed: true
      requires_approval: false
      time_restrictions:
        - start_time: "00:00"
          end_time: "23:59"
          days_of_week: [0,1,2,3,4,5,6]
          timezone: "UTC"

  # Maintenance windows
  maintenance_windows:
    - name: "weekly_maintenance"
      description: "Weekly maintenance window"
      start_time: "2024-01-01T02:00:00Z"
      end_time: "2024-01-01T04:00:00Z"
      timezone: "UTC"
      recurrence: "weekly"
      days_of_week: [1]  # Monday
    - name: "monthly_maintenance"
      description: "Monthly maintenance window"
      start_time: "2024-01-01T01:00:00Z"
      end_time: "2024-01-01T05:00:00Z"
      timezone: "UTC"
      recurrence: "monthly"
      day_of_month: 1

  # Policy lifecycle
  created_at: "2024-01-01T00:00:00Z"
  created_by: "security-admin"
  effective_from: "2024-01-01T00:00:00Z"