# Production Security Configuration

# This configuration adds application-level authentication and authorization
# on top of Tailscale network isolation.
# Suitable for: Production deployments, multi-user environments

server:
  host: "0.0.0.0"
  port: 8080
  transport: "http-sse"
  
security:
  # AUTHENTICATION REQUIRED
  auth_required: true
  
  # Token configuration - REPLACE WITH YOUR SECRET
  # Generate with: openssl rand -hex 32
  token_type: "hmac"  # or "jwt"
  
  rate_limit: 100
  max_file_size: 10485760  # 10MB

logging:
  level: "INFO"
  file: "/var/log/systemmanager/mcp.log"
  
audit:
  enabled: true
  file: "/var/log/systemmanager/audit.log"
  # Log format: JSONL (one JSON object per line)
  # Includes: timestamp, tool, user, scopes, result, Tailscale identity

docker:
  socket_path: "/var/run/docker.sock"

filesystem:
  # Restrict file access to specific paths
  allowed_paths:
    - "/var/log"
    - "/tmp"
    - "/home"
  
  # Deny patterns (applied after allowed_paths)
  denied_patterns:
    - "**/.ssh/**"
    - "**/.aws/**"
    - "**/.config/**"
    - "**/id_rsa*"
    - "**/id_ed25519*"

# Scope enforcement enabled
# Tokens must include required scopes for each operation

# Environment variables required:
# - SYSTEMMANAGER_SHARED_SECRET=<your-secret>  (if using HMAC)
# - SYSTEMMANAGER_JWT_SECRET=<your-secret>     (if using JWT)
# - SYSTEMMANAGER_REQUIRE_AUTH=true

# Token best practices:
# - Use separate tokens for each client/agent
# - Set expiry (TTL) to 30 days or less
# - Grant minimum required scopes (principle of least privilege)
# - Rotate tokens monthly
# - Revoke compromised tokens immediately

# Example token scopes:
# - readonly: Safe for monitoring/observability tools
# - container:read,container:write: For container orchestration
# - admin: Full access (use sparingly, short TTL)
